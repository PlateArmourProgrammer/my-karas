{"version":3,"file":"index.js","sources":["src/index.js"],"sourcesContent":["import karas from 'karas';\n\nclass MyCtx {\n  constructor(ctx) {\n    this.__ctx = ctx;\n    [\n      'fillStyle',\n      'strokeStyle',\n      'lineWidth',\n      'lineCap',\n      'lineDash',\n      'globalAlpha',\n    ].forEach(k => {\n      let nk = 'set' + k.charAt(0).toUpperCase() + k.slice(1);\n      Object.defineProperty(this, k, {\n        set(v) {\n          ctx[nk](v);\n        },\n      });\n    });\n    Object.defineProperty(this, 'font', {\n      set(v) {\n        let size = /(\\d+)px/.exec(v);\n        ctx.setFontSize(size[1]);\n      },\n    });\n  }\n\n  get ctx() {\n    return this.__ctx;\n  }\n}\n\n[\n  'measureText',\n  'setTransform',\n  'setLineDash',\n  'clearRect',\n  'fillText',\n  'fill',\n  'stroke',\n  'beginPath',\n  'closePath',\n  'rect',\n  'arc',\n  'moveTo',\n  'lineTo',\n  'bezierCurveTo',\n  'quadraticCurveTo',\n].forEach(fn => {\n  MyCtx.prototype[fn] = function() {\n    let ctx = this.ctx;\n    if(ctx[fn]) {\n      return ctx[fn].apply(ctx, arguments);\n    }\n  };\n});\n\nkaras.inject.requestAnimationFrame = function(cb) {\n  setTimeout(cb, 1000 / 60);\n};\n\nclass Root extends karas.Root {\n  appendTo(ctx) {\n    this.__initProps();\n    this.__refreshLevel = karas.level.REFLOW;\n    this.__ctx = new MyCtx(ctx);\n    this.__renderMode = karas.mode.CANVAS;\n    this.__defs = {\n      clear() {},\n    };\n    let { style } = this;\n    if(['flex', 'block'].indexOf(style.display) === -1) {\n      style.display = 'block';\n    }\n    // 同理position不能为absolute\n    if(style.position === 'absolute') {\n      style.position = 'static';\n    }\n    let { renderMode, ctx: myCtx } = this;\n    this.__traverse(myCtx, undefined, renderMode);\n    this.__traverseCss(this, this.props.css);\n    this.__init();\n    this.refresh();\n  }\n\n  refresh(cb) {\n    let ctx = this.ctx.ctx;\n\n    function wrap() {\n      ctx.draw();\n      cb && cb();\n    }\n\n    super.refresh(wrap);\n  }\n}\n\nlet createVd = karas.createVd;\nkaras.createVd = function(tagName, props, children) {\n  if(['canvas', 'svg'].indexOf(tagName) > -1) {\n    return new Root(tagName, props, children);\n  }\n  return createVd(tagName, props, children);\n};\n\nexport default karas;\n"],"names":["MyCtx","ctx","__ctx","forEach","k","nk","charAt","toUpperCase","slice","Object","defineProperty","set","v","size","exec","setFontSize","fn","prototype","apply","arguments","karas","inject","requestAnimationFrame","cb","setTimeout","Root","__initProps","__refreshLevel","level","REFLOW","__renderMode","mode","CANVAS","__defs","clear","style","indexOf","display","position","renderMode","myCtx","__traverse","undefined","__traverseCss","props","css","__init","refresh","wrap","draw","createVd","tagName","children"],"mappings":"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"}