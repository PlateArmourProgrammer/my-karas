{"version":3,"file":"index.js","sources":["src/index.js"],"sourcesContent":["import karas from 'karas';\n\nclass MyCtx {\n  constructor(ctx) {\n    this.__ctx = ctx;\n    [\n      'fillStyle',\n      'strokeStyle',\n      'lineWidth',\n    ].forEach(k => {\n      const nk = 'set' + k.charAt(0).toUpperCase() + k.slice(1);\n      Object.defineProperty(this, k, {\n        set(v) {\n          ctx[nk](v);\n        },\n      });\n    });\n    Object.defineProperty(this, 'font', {\n      set(v) {\n        const size = /(\\d+)px/.exec(v);\n        ctx.setFontSize(size[1]);\n      },\n    });\n  }\n\n  get ctx() {\n    return this.__ctx;\n  }\n}\n\n[\n  'measureText',\n  'setTransform',\n  'setLineDash',\n  'clearRect',\n  'fillText',\n  'fill',\n  'stroke',\n  'beginPath',\n  'closePath',\n  'rect',\n  'arc',\n  'moveTo',\n  'lineTo',\n  'ellipse',\n  'bezierCurveTo',\n  'quadraticCurveTo',\n].forEach(fn => {\n  MyCtx.prototype[fn] = function() {\n    const ctx = this.ctx;\n    if (ctx[fn]) {\n      return ctx[fn].apply(ctx, arguments);\n    }\n  };\n});\n\nkaras.inject.requestAnimationFrame = function(cb) {\n  setTimeout(cb, 16.7);\n};\n\nclass Root extends karas.Root {\n  constructor(...data) {\n    super(...data);\n  }\n  appendTo(ctx) {\n    this.__initProps();\n    if (this.tagName.toUpperCase() === 'SVG') {\n      this.__renderMode = karas.mode.SVG;\n      return;\n    }\n    if (this.tagName.toUpperCase() === 'CANVAS') {\n      this.__ctx = new MyCtx(ctx);\n      this.__renderMode = karas.mode.CANVAS;\n    }\n    const { style } = this;\n    if ([ 'flex', 'block' ].indexOf(style.display) === -1) {\n      style.display = 'block';\n    }\n    // 同理position不能为absolute\n    if (style.position === 'absolute') {\n      style.position = 'static';\n    }\n    const { renderMode, ctx: myCtx } = this;\n    this.__traverse(myCtx, undefined, renderMode);\n    this.__traverseCss(this, this.props.css);\n    this.__init();\n    this.refresh();\n  }\n\n  refresh(cb) {\n    const ctx = this.ctx.ctx;\n    function wrap() {\n      ctx.draw();\n      cb && cb();\n    }\n    super.refresh(wrap);\n  }\n}\n\nconst createVd = karas.createVd;\nkaras.createVd = function(tagName, props, children) {\n  if ([ 'canvas', 'svg' ].indexOf(tagName) > -1) {\n    return new Root(tagName, props, children);\n  }\n  return createVd(tagName, props, children);\n};\n"],"names":["MyCtx","ctx","__ctx","forEach","k","nk","charAt","toUpperCase","slice","Object","defineProperty","set","v","size","exec","setFontSize","fn","prototype","apply","arguments","karas","inject","requestAnimationFrame","cb","setTimeout","Root","data","__initProps","tagName","__renderMode","mode","SVG","CANVAS","style","indexOf","display","position","renderMode","myCtx","__traverse","undefined","__traverseCss","props","css","__init","refresh","wrap","draw","createVd","children"],"mappings":"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"}