{"version":3,"file":"index.js","sources":["src/util.js","src/canvas1.js","src/canvas2.js","src/index.js"],"sourcesContent":["const toString = {}.toString;\n\nexport const isFunction = function(obj) {\n  return toString.call(obj) === '[object CallbackFunction]' || toString.call(obj) === '[object Function]';\n}\n","import { isFunction } from './util';\n\nconst CANVAS = {};\nconst CANVAS_LIST = [];\n\nexport default function injectCanvas1(karas, createVd, Root) {\n  class newRoot extends Root {\n    refresh(cb, isFirst) {\n      let self = this;\n      let ctx = self.ctx;\n      // 小程序bug，可能restore失败，刷新前手动restore下\n      ctx.restore();\n\n      function wrap() {\n        ctx.draw && ctx.draw(true, function() {\n          self.emit('myRefresh');\n        });\n      }\n\n      super.refresh(wrap, isFirst);\n    }\n  }\n\n  karas.createVd = function(tagName, props, children) {\n    if(['canvas', 'svg'].indexOf(tagName) > -1) {\n      return new newRoot(tagName, props, children);\n    }\n    return createVd(tagName, props, children);\n  };\n\n  const IMG = karas.inject.IMG;\n  const INIT = karas.inject.INIT;\n  const LOADING = karas.inject.LOADING;\n  const LOADED = karas.inject.LOADED;\n\n  karas.inject.checkSupportFontFamily = () => false\n\n  karas.inject.measureImg = function(url, cb, optinos = {}) {\n    if(url.indexOf('data:') === 0) {\n      let { width = {}, height = {} } = optinos;\n      cb({\n        success: true,\n        width: width.value,\n        height: height.value,\n        url,\n        source: url,\n      });\n      return;\n    }\n    let cache = IMG[url] = IMG[url] || {\n      state: INIT,\n      task: [],\n    };\n    if(cache.state === LOADED) {\n      cb(cache);\n    }\n    else if(cache.state === LOADING) {\n      cache.task.push(cb);\n    }\n    else {\n      cache.state = LOADING;\n      cache.task.push(cb);\n      my.getImageInfo({\n        src: url,\n        success: function(res) {\n          cache.state = LOADED;\n          cache.success = true;\n          cache.width = res.width;\n          cache.height = res.height;\n          cache.source = url;\n          cache.url = url;\n          let list = cache.task.splice(0);\n          list.forEach(cb => cb(cache));\n        },\n        fail: function() {\n          cache.state = LOADED;\n          cache.success = false;\n          cache.url = url;\n          let list = cache.task.splice(0);\n          list.forEach(cb => cb(cache));\n        },\n      });\n    }\n  };\n\n  karas.inject.isDom = function(o) {\n    return o && (o.getContext || o.arc);\n  }\n\n  karas.inject.hasCacheCanvas = function(key) {\n    return key && CANVAS.hasOwnProperty(key);\n  };\n  karas.inject.getCacheCanvas = function(w, h, key, message) {\n    if(message) {\n      key = message;\n    }\n    // console.log(message,CANVAS);\n    if(!CANVAS[key]) {\n      throw new Error('Need a cache canvas');\n    }\n    let o = CANVAS[key];\n    return {\n      ctx: o,\n      canvas: o,\n      draw() {\n        o.draw(true);\n      },\n    };\n  };\n  karas.inject.setCacheCanvas = function(k, v) {\n    CANVAS[k] = v;\n  };\n\n  karas.inject.releaseCacheCanvas = function(o) {\n    CANVAS_LIST.push(o);\n  };\n\n  karas.inject.delCacheCanvas = function(key) {\n    key && delete CANVAS[key];\n  };\n}\n","import karas from 'karas';\nimport { isFunction } from './util';\n\nexport default function() {\n  class Root extends karas.Root {\n    appendTo(dom) {\n      if(isFunction(dom.getContext)) {\n        this.__dom = dom;\n        this.__ctx = dom.getContext('2d');\n      }\n      else {\n        this.__dom = {};\n        this.__ctx = dom;\n      }\n      this.__children = karas.builder.initRoot(this.__cd, this);\n      this.__initProps();\n      this.__root = this;\n      this.cache = !!this.props.cache;\n      this.__refreshLevel = karas.refresh.level.REFLOW;\n      this.__renderMode = karas.mode.CANVAS;\n      this.__defs = {\n        clear() {},\n      };\n      this.refresh(null, true);\n      if(this.__dom.__root) {\n        this.__dom.__root.destroy();\n      }\n      this.__dom.root = this;\n    }\n\n    refresh(cb, isFirst) {\n      let self = this;\n      let ctx = self.ctx;\n      ctx.restore();\n\n      function wrap() {\n        ctx.draw && ctx.draw(true, function() {\n          self.emit('myRefresh');\n        });\n      }\n\n      super.refresh(wrap, isFirst);\n    }\n  }\n\n  // Root引用指过来\n  let createVd = karas.createVd;\n  karas.createVd = function(tagName, props, children) {\n    if(['canvas', 'svg'].indexOf(tagName) > -1) {\n      return new Root(tagName, props, children);\n    }\n    return createVd(tagName, props, children);\n  };\n\n  const IMG = karas.inject.IMG;\n  const INIT = karas.inject.INIT;\n  const LOADING = karas.inject.LOADING;\n  const LOADED = karas.inject.LOADED;\n\n  karas.inject.measureImg = function(url, cb, optinos = {}) {\n    let { root, width = 0, height = 0 } = optinos;\n    let ctx = root.ctx;\n    if(url.indexOf('data:') === 0) {\n      let img = ctx.canvas.createImage();\n      img.onload = function() {\n        cb({\n          success: true,\n          width: width,\n          height: height,\n          url,\n          source: img,\n        });\n      };\n      img.src = url;\n      return;\n    }\n    let cache = IMG[url] = IMG[url] || {\n      state: INIT,\n      task: [],\n    };\n    if(cache.state === LOADED) {\n      cb(cache);\n    }\n    else if(cache.state === LOADING) {\n      cache.task.push(cb);\n    }\n    else {\n      cache.state = LOADING;\n      cache.task.push(cb);\n      my.getImageInfo({\n        src: url,\n        success: function(res) {\n          let img = ctx.canvas.createImage();\n          img.onload = function() {\n            cache.state = LOADED;\n            cache.success = true;\n            cache.width = res.width;\n            cache.height = res.height;\n            cache.source = img;\n            cache.url = url;\n            let list = cache.task.splice(0);\n            list.forEach(cb => cb(cache));\n          };\n          img.src = url;\n        },\n        fail: function() {\n          cache.state = LOADED;\n          cache.success = false;\n          cache.url = url;\n          let list = cache.task.splice(0);\n          list.forEach(cb => cb(cache));\n        },\n      });\n    }\n  };\n\n  karas.inject.isDom = function(o) {\n    return o && (o.getContext || o.arc);\n  }\n\n  const CANVAS = {};\n  const CANVAS_LIST = [];\n  const WEBGL_LIST = [];\n\n  function cache(key, width, height, hash, message) {\n    let o;\n    if(!key) {\n      let target = hash === CANVAS ? CANVAS_LIST : WEBGL_LIST;\n      if(target.length) {\n        o = target.pop();\n      }\n      else {\n        o = my._createOffscreenCanvas(width, height);\n      }\n    }\n    else if(!hash[key]) {\n      o = hash[key] = my._createOffscreenCanvas(width, height);\n    }\n    else {\n      o = hash[key];\n    }\n    o.width = width;\n    o.height = height;\n    return {\n      canvas: o,\n      ctx: hash === CANVAS ? o.getContext('2d')\n        : (o.getContext('webgl') || o.getContext('experimental-webgl')),\n      draw() {\n        // 空函数，仅对小程序提供hook特殊处理，flush缓冲\n      },\n      available: true,\n      release() {\n        if(!key) {\n          if(hash === CANVAS) {\n            CANVAS_LIST.push(this.canvas);\n          }\n          else {\n            WEBGL_LIST.push(this.canvas);\n          }\n        }\n        this.canvas = null;\n        this.ctx = null;\n      },\n    };\n  }\n\n  function cacheCanvas(key, width, height, message) {\n    return cache(key, width, height, CANVAS, message);\n  }\n\n  karas.inject.hasCacheCanvas = function(key) {\n    return key && CANVAS.hasOwnProperty(key);\n  };\n\n  karas.inject.getCacheCanvas = function(width, height, key, message) {\n    return cacheCanvas(key, width, height, message);\n  };\n\n  karas.inject.releaseCacheCanvas = function(o) {\n    CANVAS_LIST.push(o);\n  };\n\n  karas.inject.delCacheCanvas = function(key) {\n    key && delete CANVAS[key];\n  };\n};\n","import karas from 'karas';\nimport { version } from '../package.json';\nimport { isFunction } from './util';\nimport injectCanvas1 from './canvas1';\nimport injectCanvas2 from './canvas2';\n\nkaras.inject.requestAnimationFrame = function(cb) {\n  setTimeout(cb, 1000 / 60);\n};\n\nkaras.myVersion = version;\n\nclass Root extends karas.Root {\n  static __isCanvas2 = false;\n\n  // 需要小程序内部监听事件手动调用\n  onEvent(e) {\n    this.__wrapEvent(e, data => {\n      this.__emitEvent(data);\n    });\n  }\n\n  __wrapEvent(e, cb) {\n    const id = this.__ctx?.id || this.__dom?.id;\n    id && my.createSelectorQuery().select(`#${id}`).boundingClientRect().exec(ret => {\n      let x, y;\n\n      if(ret && ret[0] && e.detail) {\n        const { clientX, clientY, x: ox, y: oy } = e.detail;\n        const { left, top, width, height } = ret[0];\n        const { __scx, __scy } = this;\n\n        x = ox ?? clientX - left;\n        y = oy ?? clientY - top;\n\n        if(!karas.util.isNil(__scx)) {\n          x /= __scx;\n        }\n        else {\n          x *= this.width / width;\n        }\n        if(!karas.util.isNil(__scy)) {\n          y /= __scy;\n        }\n        else {\n          y *= this.height / height;\n        }\n      }\n      cb({\n        event: e,\n        stopPropagation() {\n          this.__stopPropagation = true;\n        },\n        stopImmediatePropagation() {\n          this.__stopPropagation = true;\n          this.__stopImmediatePropagation = true;\n        },\n        preventDefault() {\n        },\n        x,\n        y,\n        __hasEmitted: false,\n      });\n    });\n  }\n\n  appendTo(dom) {\n    if(isFunction(dom.getContext)) {\n      if(Root.__isCanvas2) {\n        karas.inject.requestAnimationFrame = dom.requestAnimationFrame.bind(dom) || karas.inject.requestAnimationFrame;\n      }\n      this.__dom = dom;\n      this.__ctx = dom.getContext('2d');\n    }\n    else {\n      this.__dom = {};\n      this.__ctx = dom;\n    }\n    this.__children = karas.builder.initRoot(this.__cd, this);\n    this.__initProps();\n    this.__root = this;\n    this.cache = !!this.props.cache;\n    this.__refreshLevel = karas.refresh.level.REFLOW;\n    this.__renderMode = karas.mode.CANVAS;\n    this.__defs = {\n      clear() {\n      },\n    };\n    this.refresh(null, true);\n    if(this.__dom.__root) {\n      this.__dom.__root.destroy();\n    }\n    this.__dom.root = this;\n  }\n}\n\nconst createVd = karas.createVd;\n\nlet injected = false;\ninjectCanvas1(karas, createVd, Root);\n\nexport function setCanvasType(type) {\n  // 只允许注入一次\n  if(injected) {\n    return;\n  }\n  injected = true;\n  if(type === 'canvas2') {\n    Root.__isCanvas2 = true;\n    injectCanvas2(karas, createVd, Root);\n  }\n}\n\nexport default karas;\n"],"names":["toString","isFunction","obj","call","CANVAS","injectCanvas1","karas","createVd","Root","newRoot","cb","isFirst","self","ctx","restore","wrap","draw","emit","tagName","props","children","indexOf","IMG","inject","INIT","LOADING","LOADED","checkSupportFontFamily","measureImg","url","optinos","width","height","success","value","source","cache","state","task","push","my","getImageInfo","src","res","list","splice","forEach","fail","isDom","o","getContext","arc","hasCacheCanvas","key","hasOwnProperty","getCacheCanvas","w","h","message","Error","canvas","setCacheCanvas","k","v","releaseCacheCanvas","CANVAS_LIST","delCacheCanvas","dom","__dom","__ctx","__children","builder","initRoot","__cd","__initProps","__root","__refreshLevel","refresh","level","REFLOW","__renderMode","mode","__defs","clear","destroy","root","img","createImage","onload","WEBGL_LIST","hash","target","length","pop","_createOffscreenCanvas","available","release","cacheCanvas","requestAnimationFrame","setTimeout","myVersion","version","e","__wrapEvent","data","__emitEvent","id","createSelectorQuery","select","boundingClientRect","exec","ret","x","y","detail","clientX","clientY","ox","oy","left","top","__scx","__scy","util","isNil","event","stopPropagation","__stopPropagation","stopImmediatePropagation","__stopImmediatePropagation","preventDefault","__hasEmitted","__isCanvas2","bind","injected","setCanvasType","type","injectCanvas2"],"mappings":"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"}