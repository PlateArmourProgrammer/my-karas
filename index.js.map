{"version":3,"file":"index.js","sources":["src/index.js"],"sourcesContent":["import karas from 'karas';\n\nkaras.inject.requestAnimationFrame = function(cb) {\n  setTimeout(cb, 1000 / 60);\n};\n\nclass Root extends karas.Root {\n  appendTo(ctx) {\n    this.__initProps();\n    this.__refreshLevel = karas.level.REFLOW;\n    this.__ctx = ctx;\n    this.__renderMode = karas.mode.CANVAS;\n    this.__defs = {\n      clear() {},\n    };\n    let { style } = this;\n    if(['flex', 'block'].indexOf(style.display) === -1) {\n      style.display = 'block';\n    }\n    // 同理position不能为absolute\n    if(style.position === 'absolute') {\n      style.position = 'static';\n    }\n    let { renderMode, ctx: myCtx } = this;\n    this.__traverse(myCtx, undefined, renderMode);\n    this.__traverseCss(this, this.props.css);\n    this.__init();\n    this.refresh();\n  }\n\n  refresh(cb) {\n    let ctx = this.ctx;\n\n    function wrap() {\n      ctx.draw(true);\n      cb && cb();\n    }\n\n    super.refresh(wrap);\n  }\n}\n\n// Root引用指过来\nlet createVd = karas.createVd;\nkaras.createVd = function(tagName, props, children) {\n  if(['canvas', 'svg'].indexOf(tagName) > -1) {\n    return new Root(tagName, props, children);\n  }\n  return createVd(tagName, props, children);\n};\n\nkaras.inject.measureImg = function(src, cb, optinos = {}) {\n  if(src.indexOf('data:') === 0) {\n    let { width = {}, height = {} } = optinos;\n    cb({\n      success: true,\n      width: width.value,\n      height: height.value,\n      source: src,\n    });\n    return;\n  }\n  my.getImageInfo({\n    src,\n    success: function(res) {\n      cb({\n        success: true,\n        width: res.width,\n        height: res.height,\n        source: src,\n      });\n    },\n    fail: function() {\n      cb({\n        success: false,\n      });\n    },\n  });\n};\n\nkaras.inject.isDom = function(o) {\n  return karas.util.isFunction(o.arc);\n}\n\nlet cc, mc;\n\nkaras.inject.setCacheCanvas = function(o) {\n  cc = o;\n};\n\nkaras.inject.setMaskCanvas = function(o) {\n  mc = o;\n};\n\nkaras.inject.getCacheCanvas = function() {\n  if(!cc) {\n    throw new Error('Need a cache canvas');\n  }\n  return {\n    ctx: cc,\n    canvas: cc,\n    draw(ctx) {\n      ctx.draw(true);\n    },\n  };\n};\n\nkaras.inject.getMaskCanvas = function() {\n  if(!mc) {\n    throw new Error('Need a mask canvas');\n  }\n  return {\n    ctx: mc,\n    canvas: mc,\n    draw(ctx) {\n      ctx.draw(true);\n    },\n  };\n};\n\nexport default karas;\n"],"names":["karas","inject","requestAnimationFrame","cb","setTimeout","Root","ctx","__initProps","__refreshLevel","level","REFLOW","__ctx","__renderMode","mode","CANVAS","__defs","clear","style","indexOf","display","position","renderMode","myCtx","__traverse","undefined","__traverseCss","props","css","__init","refresh","wrap","draw","createVd","tagName","children","measureImg","src","optinos","width","height","success","value","source","my","getImageInfo","res","fail","isDom","o","util","isFunction","arc","cc","mc","setCacheCanvas","setMaskCanvas","getCacheCanvas","Error","canvas","getMaskCanvas"],"mappings":"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"}